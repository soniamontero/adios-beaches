<!-- First top part with search and filters -->
<div class="experience-index-background" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(<%= asset_path 'palm-leaves.jpeg' %>)">
  <div class="experiences-index-container">
    <h1 class="second-white-title px-2 pb-3">
      <span>Find the best spots&nbsp;</span>
      <span>in <strong>Bali.</strong></span>
    </h1>

    <div class="home-search-form mt-3 mb-5">
      <%= form_tag experiences_path, method: :get do %>
        <%= text_field_tag :query,
          params[:query],
          class: "search-bar-home",
          placeholder: @placeholder
        %>
        <button class="btn">
          <i class="fas fa-search white-color"></i>
        </button>
        <%#= submit_tag "Search", class: "btn btn-primary" %>
      <% end %>
    </div>

    <div class="category-icons-scroll">
      <div class="category-icons-index">
        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Food"
            %>
            <%= image_submit_tag("food.png", class: 'category-icon food', alt: 'Food') %>
          <% end %>
        </div>

        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Arts"
            %>
            <%= image_submit_tag("arts.png", class: 'category-icon arts', alt: 'Arts') %>
          <% end %>
        </div>
        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Nature"
            %>
            <%= image_submit_tag("monkey.png", class: 'category-icon nature', alt: 'Nature') %>
          <% end %>
        </div>
        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Nightlife"
            %>
            <%= image_submit_tag("nightlife.png", class: 'category-icon nightlife', alt: 'Nightlife') %>
          <% end %>
        </div>
        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Stays"
            %>
            <%= image_submit_tag("stays.png", class: 'category-icon stays', alt: 'Stays') %>
          <% end %>
        </div>
        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Sports"
            %>
            <%= image_submit_tag("sports.png", class: 'category-icon sports', alt: 'Sports') %>
          <% end %>
        </div>
        <div>
          <%= form_tag experiences_path, method: :get do %>
            <%= hidden_field_tag :category,
              params[:category], value: "Shopping"
            %>
            <%= image_submit_tag("shopping.png", class: 'category-icon shopping', alt: 'Shopping') %>
          <% end %>
        </div>
      </div>
    </div>

    <p class="search-results-info">
      <% if @params_present %>
        Results for '<%= @placeholder %>': <strong><%= @experiences.count %></strong>
      <% else %>
        Total 'tropic like it's hot!' spots: <strong><%= @experiences.count %></strong>
      <% end %>
    </p>


  <!--   <div class="experiences-filter-form">
      <%#= form_tag({:controller => "experiences", :action => "index"}, method: :get) do %>
        <%#= select_tag "category", options_for_select(["Filter"] + Category.pluck(:name).uniq), onchange: "this.form.submit();", class: "custom-select" %>
      <%# end %>
    </div> -->

  </div>
</div>

<!-- end of first top part filters and search -->

<!-- Begining of results container -->
<div class="experience-cards-container">
  <% @experiences.each do |experience| %>

    <div class="experience-card">
      <div class="experience-card-photo">
        <% if experience.photo.file.nil? %>
          <%= image_tag asset_path('photo-not-found.jpeg') %>
        <% else %>
          <%= cl_image_tag experience.photo %>
        <% end %>
      </div>
      <!-- Start statement for vote button on experience -->
      <div class="experience-card-vote-buttons">

        <!-- VOTE + UPVOTE -->
        <% if current_user.has_voted?(experience) && current_user.has_upvoted?(experience) %>
          <%= link_to vote_path(Vote.find_by_experience(current_user, experience), redirect_to: 'index'), method: :delete do %>
            <i class="fas fa-chevron-up upvote-button activated"></i>
          <% end %>
          <span class="vote-text <% experience.total_votes_state %>">
            <%= experience.total_votes %>
          </span>
          <%= link_to vote_path(Vote.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :put do %>
             <i class="fas fa-chevron-down downvote-button"></i>
          <% end %>

        <!-- VOTE + DOWNVOTE -->
        <% elsif current_user.has_voted?(experience) && current_user.has_downvoted?(experience) %>
          <%= link_to vote_path(Vote.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :put do %>
            <i class="fas fa-chevron-up upvote-button"></i>
          <% end %>
          <span class="vote-text">
            <%= experience.total_votes %>
          </span>
          <%= link_to vote_path(Vote.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :delete do %>
            <i class="fas fa-chevron-down downvote-button activated"></i>
          <% end %>

        <!-- NO VOTE -->
        <% else %>
          <%= simple_form_for [experience, Vote.new] do |f| %>
            <%= hidden_field_tag(:value, 1) %>
            <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
              <i class="fas fa-chevron-up upvote-button"></i>
            <% end %>
          <% end %>
          <span class="vote-text">
            <%= experience.total_votes %>
          </span>
          <%= simple_form_for [experience, Vote.new] do |f| %>
            <%= hidden_field_tag(:value, -1) %>
            <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
              <i class="fas fa-chevron-down downvote-button"></i>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <!-- End statement for vote button on experience -->

      <div class="experience-card-info">
        <div class="experience-card-name">
          <%= experience.name %>
        </div>
        <div class="experience-card-category">
          <%= experience.category.name %> &nbsp;&nbsp;-&nbsp;&nbsp;
          <span class="experience-price-range">
            <%= experience.price_range_to_icon %>
          </span>
        </div>
        <div class="experience-card-location">
          <%= experience.address.split(',')[2] %>
        </div>
      </div>



      <div class="experience-card-buttons">
        <!-- Statement for done button on experience -->
        <div class="experience-card-done-button <%= current_user.has_done?(experience).nil? ? 'deactivated' : 'activated' %>">
          <% if current_user.has_done?(experience) %>
            <%= link_to done_path(Done.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :delete do %>
                <i class="fas fa-check"></i>
            <% end %>
          <% else %>
            <%= simple_form_for [experience, Done.new] do |f| %>
              <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
                <i class="fas fa-check"></i>
            <% end %>
              <%#= f.button :button, 'Done', type: 'submit', name: 'redirect_to', value: 'show' %>
            <% end %>
          <% end %>
        </div>
        <!-- End of statement for done button on experience -->


        <!-- Statement for favorite button on experience -->
        <div class="experience-card-favorite-button <%= current_user.has_favorite?(experience).nil? ? 'deactivated' : 'activated' %>">
          <% if current_user.has_favorite?(experience) %>
            <%= link_to favorite_path(Favorite.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :delete do %>
              <i class="fas fa-heart"></i>
            <% end %>
          <% else %>
            <%= simple_form_for [experience, Favorite.new] do |f| %>
              <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
                <i class="fas fa-heart"></i>
              <% end %>
            <% end %>
          <% end %>
        </div>
        <!-- End of statement for favorite button on experience -->
      </div>
    </div>
    <%#= link_to 'show', experience_path(experience.id) %>
  <% end %>
</div>
<!-- End of results container -->

<!-- Beginning of map -->
<div
  id="map"
  style="width: 100%;
  height: 600px;"
  data-markers="<%= @markers.to_json %>"
  data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
></div>
<!-- End of map -->



