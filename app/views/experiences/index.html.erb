<div class="experiences-filter-form">
  <%= form_tag({:controller => "experiences", :action => "index"}, method: :get) do %>
    <%= select_tag "category", options_for_select(["Filter"] + Category.pluck(:name).uniq), onchange: "this.form.submit();", class: "custom-select" %>
  <% end %>
</div>

<div class="experience-cards-container">
  <% @experiences.each do |experience| %>

    <div class="experience-card">
      <!-- Start statement for vote button on experience -->
      <div class="experience-card-vote-buttons">

        <!-- VOTE + UPVOTE -->
        <% if current_user.has_voted?(experience) && current_user.has_upvoted?(experience) %>
          <%= link_to vote_path(Vote.find_by_experience(current_user, experience), redirect_to: 'index'), method: :delete do %>
            <i class="fas fa-chevron-up upvote-button activated"></i>
          <% end %>
          <span class="vote-text">
            <%= experience.total_votes %>
          </span>
          <%= link_to vote_path(Vote.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :put do %>
             <i class="fas fa-chevron-down downvote-button"></i>
          <% end %>

        <!-- VOTE + DOWNVOTE -->
        <% elsif current_user.has_voted?(experience) && current_user.has_downvoted?(experience) %>
          <%= link_to vote_path(Vote.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :put do %>
            <i class="fas fa-chevron-up upvote-button"></i>
          <% end %>
          <span class="vote-text">
            <%= experience.total_votes %>
          </span>
          <%= link_to vote_path(Vote.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :delete do %>
            <i class="fas fa-chevron-down downvote-button activated"></i>
          <% end %>

        <!-- NO VOTE -->
        <% else %>
          <%= simple_form_for [experience, Vote.new] do |f| %>
            <%= hidden_field_tag(:value, 1) %>
            <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
              <i class="fas fa-chevron-up upvote-button"></i>
            <% end %>
          <% end %>
          <span class="vote-text">
            <%= experience.total_votes %>
          </span>
          <%= simple_form_for [experience, Vote.new] do |f| %>
            <%= hidden_field_tag(:value, -1) %>
            <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
              <i class="fas fa-chevron-down downvote-button"></i>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <!-- End statement for vote button on experience -->
      <div class="experience-card-photo">
        <% if experience.photo.file.nil? %>
          <%= image_tag asset_path('photo-not-found.jpeg') %>
        <% else %>
          <%= cl_image_tag experience.photo %>
        <% end %>
      </div>
      <div class="experience-card-info">
        <div class="experience-card-name">
          <%= experience.name %>
        </div>
        <div class="experience-card-category">
          <%= experience.category.name %> &nbsp;&nbsp;-&nbsp;&nbsp;
          <span class="experience-price-range">
            <%= experience.price_range_to_icon %>
          </span>
        </div>
        <div class="experience-card-location">
          <%= experience.address.split(',')[2] %>
        </div>

      </div>
      <div class="experience-card-buttons">
        <!-- Statement for done button on experience -->
        <div class="experience-card-done-button <%= current_user.has_done?(experience).nil? ? 'deactivated' : 'activated' %>">
          <% if current_user.has_done?(experience) %>
            <%= link_to done_path(Done.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :delete do %>
                <i class="fas fa-check"></i>
            <% end %>
          <% else %>
            <%= simple_form_for [experience, Done.new] do |f| %>
              <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
                <i class="fas fa-check"></i>
            <% end %>
              <%#= f.button :button, 'Done', type: 'submit', name: 'redirect_to', value: 'show' %>
            <% end %>
          <% end %>
        </div>
        <!-- End of statement for done button on experience -->


        <!-- Statement for favorite button on experience -->
        <div class="experience-card-favorite-button <%= current_user.has_favorite?(experience).nil? ? 'deactivated' : 'activated' %>">
          <% if current_user.has_favorite?(experience) %>
            <%= link_to favorite_path(Favorite.where(experience_id: experience.id, user_id: current_user.id).first, redirect_to: 'index'), method: :delete do %>
              <i class="fas fa-heart"></i>
            <% end %>
          <% else %>
            <%= simple_form_for [experience, Favorite.new] do |f| %>
              <%= button_tag type: 'submit', name: 'redirect_to', value: 'index' do %>
                <i class="fas fa-heart"></i>
              <% end %>
            <% end %>
          <% end %>
        </div>
        <!-- End of statement for favorite button on experience -->
      </div>
    </div>
    <%#= link_to 'show', experience_path(experience.id) %>
  <% end %>
</div>

